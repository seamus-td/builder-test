import { ChangeDetectionStrategy, Component, Input } from '@angular/core';
import { Builder } from '@builder.io/sdk';
import * as i0 from "@angular/core";
import * as i1 from "@angular/platform-browser";
import * as i2 from "../../services/builder.service";
export class BuilderBlocksComponent {
    domSanitizer;
    builder;
    blocks;
    child = false;
    prerender = true;
    model = '';
    key = '';
    options = null;
    // @deprecated
    field = '';
    breakpoints;
    constructor(domSanitizer, builder) {
        this.domSanitizer = domSanitizer;
        this.builder = builder;
    }
    lastInnerHtml = '';
    lastInnerHtmlSanitized = null;
    get hasNoChildren() {
        return !(this.blocks && (this.blocks.length || this.blocks.html));
    }
    get arrayBlocks() {
        return Array.isArray(this.blocks);
    }
    get innerHtml() {
        const html = this._innerHtml;
        if (html === this.lastInnerHtml) {
            return this.lastInnerHtmlSanitized || '';
        }
        this.lastInnerHtml = html;
        this.lastInnerHtmlSanitized = this.domSanitizer.bypassSecurityTrustHtml(html);
        return this.lastInnerHtmlSanitized;
    }
    get _innerHtml() {
        // TODO: pass options too
        if (!this.prerender || Builder.isEditing) {
            return `<builder-component-element prerender="false" ${!this.model ? '' : `name="${this.model}"`}></builder-component-element>`;
        }
        const elStr = `<builder-component-element prerender="false" ${!this.model ? '' : `name="${this.model}"`}></builder-component-element>`;
        if (this.arrayBlocks || !this.blocks) {
            return elStr;
        }
        if (!this.blocks.html) {
            return elStr;
        }
        const css = this.blocks.css;
        let html = this.blocks.html;
        if (this.breakpoints) {
            if (this.breakpoints.small) {
                html = html.replace(/max-width:640/g, `max-width:${this.breakpoints.small}`);
            }
            if (this.breakpoints.medium) {
                html = html.replace(/max-width:991/g, `max-width:${this.breakpoints.medium}`);
            }
        }
        if (css) {
            html = `<style class="builder-styles">${css}</style>` + html;
        }
        return `<builder-component-element key="${this.key || this.model}" options='${JSON.stringify(this.options || null // TODO: HTML encode
        )}' prerender="false" rev="${this.blocks.rev || ''}" ${!this.model ? '' : `name="${this.model}"`}>${html}</builder-component-element>`;
    }
    trackByFn(index, value) {
        // TODO: possibly json-stable-stringify
        return value.id || (value.component && value.component.id) || JSON.stringify(value);
    }
    static ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.0.6", ngImport: i0, type: BuilderBlocksComponent, deps: [{ token: i1.DomSanitizer }, { token: i2.BuilderService }], target: i0.ɵɵFactoryTarget.Component });
    static ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "18.0.6", type: BuilderBlocksComponent, selector: "builder-blocks", inputs: { blocks: "blocks", child: "child", prerender: "prerender", model: "model", key: "key", options: "options", field: "field", breakpoints: "breakpoints" }, ngImport: i0, template: "<div class=\"builder-blocks builder-blocks-html\">\n  <div [innerHTML]=\"innerHtml\"></div>\n</div>\n", styles: [""], changeDetection: i0.ChangeDetectionStrategy.OnPush });
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.0.6", ngImport: i0, type: BuilderBlocksComponent, decorators: [{
            type: Component,
            args: [{ selector: 'builder-blocks', changeDetection: ChangeDetectionStrategy.OnPush, template: "<div class=\"builder-blocks builder-blocks-html\">\n  <div [innerHTML]=\"innerHtml\"></div>\n</div>\n" }]
        }], ctorParameters: () => [{ type: i1.DomSanitizer }, { type: i2.BuilderService }], propDecorators: { blocks: [{
                type: Input
            }], child: [{
                type: Input
            }], prerender: [{
                type: Input
            }], model: [{
                type: Input
            }], key: [{
                type: Input
            }], options: [{
                type: Input
            }], field: [{
                type: Input
            }], breakpoints: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVpbGRlci1ibG9ja3MuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2FwcC9tb2R1bGVzL2J1aWxkZXIvY29tcG9uZW50cy9idWlsZGVyLWJsb2Nrcy9idWlsZGVyLWJsb2Nrcy5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvYXBwL21vZHVsZXMvYnVpbGRlci9jb21wb25lbnRzL2J1aWxkZXItYmxvY2tzL2J1aWxkZXItYmxvY2tzLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTFFLE9BQU8sRUFBcUIsT0FBTyxFQUFFLE1BQU0saUJBQWlCLENBQUM7Ozs7QUFTN0QsTUFBTSxPQUFPLHNCQUFzQjtJQWViO0lBQW9DO0lBZC9DLE1BQU0sQ0FBTTtJQUVaLEtBQUssR0FBRyxLQUFLLENBQUM7SUFDZCxTQUFTLEdBQUcsSUFBSSxDQUFDO0lBQ2pCLEtBQUssR0FBRyxFQUFFLENBQUM7SUFDWCxHQUFHLEdBQUcsRUFBRSxDQUFDO0lBRVQsT0FBTyxHQUE2QixJQUFJLENBQUM7SUFFbEQsY0FBYztJQUNMLEtBQUssR0FBRyxFQUFFLENBQUM7SUFFWCxXQUFXLENBQU07SUFFMUIsWUFBb0IsWUFBMEIsRUFBVSxPQUF1QjtRQUEzRCxpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUFVLFlBQU8sR0FBUCxPQUFPLENBQWdCO0lBQUcsQ0FBQztJQUUzRSxhQUFhLEdBQUcsRUFBRSxDQUFDO0lBQ25CLHNCQUFzQixHQUFvQixJQUFJLENBQUM7SUFFdkQsSUFBSSxhQUFhO1FBQ2YsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMs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RUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsSUFBSSxLQUFLLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQyxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDdEYsQ0FBQzt1R0FyRlUsc0JBQXNCOzJGQUF0QixzQkFBc0Isd05DWG5DLHVHQUdBOzsyRkRRYSxzQkFBc0I7a0JBTmxDLFNBQVM7K0JBQ0UsZ0JBQWdCLG1CQUdULHVCQUF1QixDQUFDLE1BQU07OEdBR3RDLE1BQU07c0JBQWQsS0FBSztnQkFFRyxLQUFLO3NCQUFiLEtBQUs7Z0JBQ0csU0FBUztzQkFBakIsS0FBSztnQkFDRyxLQUFLO3NCQUFiLEtBQUs7Z0JBQ0csR0FBRztzQkFBWCxLQUFLO2dCQUVHLE9BQU87c0JBQWYsS0FBSztnQkFHRyxLQUFLO3NCQUFiLEtBQUs7Z0JBRUcsV0FBVztzQkFBbkIsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDb21wb25lbnQsIElucHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBEb21TYW5pdGl6ZXIsIFNhZmVIdG1sIH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlcic7XG5pbXBvcnQgeyBHZXRDb250ZW50T3B0aW9ucywgQnVpbGRlciB9IGZyb20gJ0BidWlsZGVyLmlvL3Nkayc7XG5pbXBvcnQgeyBCdWlsZGVyU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2J1aWxkZXIuc2VydmljZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2J1aWxkZXItYmxvY2tzJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2J1aWxkZXItYmxvY2tzLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vYnVpbGRlci1ibG9ja3MuY29tcG9uZW50LmNzcyddLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbn0pXG5leHBvcnQgY2xhc3MgQnVpbGRlckJsb2Nrc0NvbXBvbmVudCB7XG4gIEBJbnB1dCgpIGJsb2NrczogYW55O1xuXG4gIEBJbnB1dCgpIGNoaWxkID0gZmFsc2U7XG4gIEBJbnB1dCgpIHByZXJlbmRlciA9IHRydWU7XG4gIEBJbnB1dCgpIG1vZGVsID0gJyc7XG4gIEBJbnB1dCgpIGtleSA9ICcnO1xuXG4gIEBJbnB1dCgpIG9wdGlvbnM6IEdldENvbnRlbnRPcHRpb25zIHwgbnVsbCA9IG51bGw7XG5cbiAgLy8gQGRlcHJlY2F0ZWRcbiAgQElucHV0KCkgZmllbGQgPSAnJztcblxuICBASW5wdXQoKSBicmVha3BvaW50czogYW55O1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZG9tU2FuaXRpemVyOiBEb21TYW5pdGl6ZXIsIHByaXZhdGUgYnVpbGRlcjogQnVpbGRlclNlcnZpY2UpIHt9XG5cbiAgcHJpdmF0ZSBsYXN0SW5uZXJIdG1sID0gJyc7XG4gIHByaXZhdGUgbGFzdElubmVySHRtbFNhbml0aXplZDogU2FmZUh0bWwgfCBudWxsID0gbnVsbDtcblxuICBnZXQgaGFzTm9DaGlsZHJlbigpIHtcbiAgICByZXR1cm4gISh0aGlzLmJsb2NrcyAmJiAodGhpcy5ibG9ja3MubGVuZ3RoIHx8IHRoaXMuYmxvY2tzLmh0bWwpKTtcbiAgfVxuXG4gIGdldCBhcnJheUJsb2NrcygpIHtcbiAgICByZXR1cm4gQXJyYXkuaXNBcnJheSh0aGlzLmJsb2Nrcyk7XG4gIH1cblxuICBnZXQgaW5uZXJIdG1sKCkge1xuICAgIGNvbnN0IGh0bWwgPSB0aGlzLl9pbm5lckh0bWw7XG4gICAgaWYgKGh0bWwgPT09IHRoaXMubGFzdElubmVySHRtbCkge1xuICAgICAgcmV0dXJuIHRoaXMubGFzdElubmVySHRtbFNhbml0aXplZCB8fCAnJztcbiAgICB9XG5cbiAgICB0aGlzLmxhc3RJbm5lckh0bWwgPSBodG1sO1xuICAgIHRoaXMubGFzdElubmVySHRtbFNhbml0aXplZCA9IHRoaXMuZG9tU2FuaXRpemVyLmJ5cGFzc1NlY3VyaXR5VHJ1c3RIdG1sKGh0bWwpO1xuXG4gICAgcmV0dXJuIHRoaXMubGFzdElubmVySHRtbFNhbml0aXplZDtcbiAgfVxuXG4gIGdldCBfaW5uZXJIdG1sKCkge1xuICAgIC8vIFRPRE86IHBhc3Mgb3B0aW9ucyB0b29cbiAgICBpZiAoIXRoaXMucHJlcmVuZGVyIHx8IEJ1aWxkZXIuaXNFZGl0aW5nKSB7XG4gICAgICByZXR1cm4gYDxidWlsZGVyLWNvbXBvbmVudC1lbGVtZW50IHByZXJlbmRlcj1cImZhbHNlXCIgJHtcbiAgICAgICAgIXRoaXMubW9kZWwgPyAnJyA6IGBuYW1lPVwiJHt0aGlzLm1vZGVsfVwiYFxuICAgICAgfT48L2J1aWxkZXItY29tcG9uZW50LWVsZW1lbnQ+YDtcbiAgICB9XG5cbiAgICBjb25zdCBlbFN0ciA9IGA8YnVpbGRlci1jb21wb25lbnQtZWxlbWVudCBwcmVyZW5kZXI9XCJmYWxzZVwiICR7XG4gICAgICAhdGhpcy5tb2RlbCA/ICcnIDogYG5hbWU9XCIke3RoaXMubW9kZWx9XCJgXG4gICAgfT48L2J1aWxkZXItY29tcG9uZW50LWVsZW1lbnQ+YDtcblxuICAgIGlmICh0aGlzLmFycmF5QmxvY2tzIHx8ICF0aGlzLmJsb2Nrcykge1xuICAgICAgcmV0dXJuIGVsU3RyO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5ibG9ja3MuaHRtbCkge1xuICAgICAgcmV0dXJuIGVsU3RyO1xuICAgIH1cblxuICAgIGNvbnN0IGNzcyA9IHRoaXMuYmxvY2tzLmNzcztcbiAgICBsZXQgaHRtbCA9IHRoaXMuYmxvY2tzLmh0bWw7XG4gICAgaWYgKHRoaXMuYnJlYWtwb2ludHMpIHtcbiAgICAgIGlmICh0aGlzLmJyZWFrcG9pbnRzLnNtYWxsKSB7XG4gICAgICAgIGh0bWwgPSBodG1sLnJlcGxhY2UoL21heC13aWR0aDo2NDAvZywgYG1heC13aWR0aDoke3RoaXMuYnJlYWtwb2ludHMuc21hbGx9YCk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5icmVha3BvaW50cy5tZWRpdW0pIHtcbiAgICAgICAgaHRtbCA9IGh0bWwucmVwbGFjZSgvbWF4LXdpZHRoOjk5MS9nLCBgbWF4LXdpZHRoOiR7dGhpcy5icmVha3BvaW50cy5tZWRpdW19YCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGNzcykge1xuICAgICAgaHRtbCA9IGA8c3R5bGUgY2xhc3M9XCJidWlsZGVyLXN0eWxlc1wiPiR7Y3NzfTwvc3R5bGU+YCArIGh0bWw7XG4gICAgfVxuXG4gICAgcmV0dXJuIGA8YnVpbGRlci1jb21wb25lbnQtZWxlbWVudCBrZXk9XCIke3RoaXMua2V5IHx8IHRoaXMubW9kZWx9XCIgb3B0aW9ucz0nJHtKU09OLnN0cmluZ2lmeShcbiAgICAgIHRoaXMub3B0aW9ucyB8fCBudWxsIC8vIFRPRE86IEhUTUwgZW5jb2RlXG4gICAgKX0nIHByZXJlbmRlcj1cImZhbHNlXCIgcmV2PVwiJHt0aGlzLmJsb2Nrcy5yZXYgfHwgJyd9XCIgJHtcbiAgICAgICF0aGlzLm1vZGVsID8gJycgOiBgbmFtZT1cIiR7dGhpcy5tb2RlbH1cImBcbiAgICB9PiR7aHRtbCBhcyBzdHJpbmd9PC9idWlsZGVyLWNvbXBvbmVudC1lbGVtZW50PmA7XG4gIH1cblxuICB0cmFja0J5Rm4oaW5kZXg6IG51bWJlciwgdmFsdWU6IGFueSkge1xuICAgIC8vIFRPRE86IHBvc3NpYmx5IGpzb24tc3RhYmxlLXN0cmluZ2lmeVxuICAgIHJldHVybiB2YWx1ZS5pZCB8fCAodmFsdWUuY29tcG9uZW50ICYmIHZhbHVlLmNvbXBvbmVudC5pZCkgfHwgSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xuICB9XG59XG4iLCI8ZGl2IGNsYXNzPVwiYnVpbGRlci1ibG9ja3MgYnVpbGRlci1ibG9ja3MtaHRtbFwiPlxuICA8ZGl2IFtpbm5lckhUTUxdPVwiaW5uZXJIdG1sXCI+PC9kaXY+XG48L2Rpdj5cbiJdfQ==